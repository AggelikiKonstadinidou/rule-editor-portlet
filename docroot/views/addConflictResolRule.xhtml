<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="form" enctype="multipart/form-data">
			<p:commandLink process="@this" immediate="true"
				action="/views/initialMenu.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal">
				<h:graphicImage url="/Home.png" styleClass="basicImageStyle"
					title="Go to initial menu" />
			</p:commandLink>
			<br />
			<br />
			<p:panel id="informationPanel">
				<f:facet name="header">
					<h:outputText value="New Conflict/Resolution Rule" />
				</f:facet>
				<p:messages id="msgs" autoUpdate="true" closable="true" />

					<h:panelGrid columns="2" id="grid1">
						<p:tree id="tree" value="#{addConflictRuleBean.root}" var="node"
							orientation="horizontal" selectionMode="single"
							selection="#{addConflictRuleBean.selectedNode}"
							style="width:535px;">
							<p:ajax event="select"
								listener="#{addConflictRuleBean.onNodeSelect}"
								update=":#{p:component('dataProperties')},
								:#{p:component('objectProperties')}" />
							<p:treeNode>
								<h:outputText value="#{node}" />
							</p:treeNode>


						</p:tree>
						<h:panelGrid rows="3" id="grid2" style="width:535px;">

							<p:dataTable id="dataProperties" var="data"
								value="#{addConflictRuleBean.datatypes}" rowKey="#{data}"
								selectionMode="single"
								selection="#{addConflictRuleBean.selectedRow}">
								<p:ajax event="rowSelect"
									listener="#{addConflictRuleBean.onRowSelect}" />
							
								<p:column headerText="Data Properties">
									<h:outputText value="#{data}" />
								</p:column>

							</p:dataTable>

							<p:dataTable id="objectProperties" var="data"
								value="#{addConflictRuleBean.objects}" rowKey="#{data}"
								selectionMode="single"
								selection="#{addConflictRuleBean.selectedRow}">
								<p:ajax event="rowSelect"
									listener="#{addConflictRuleBean.onRowSelect}" />

								<p:column headerText="Object Properties">
									<h:outputText value="#{data}" />
								</p:column>


							</p:dataTable>

							<p:dataTable id="instances" var="data"
								value="#{addConflictRuleBean.instances}" rowKey="#{data}"
								selectionMode="single"
								selection="#{addConflictRuleBean.selectedRow}">
								<p:ajax event="rowSelect"
									listener="#{addConflictRuleBean.onRowSelect}" />

								<p:column headerText="Instances">
									<h:outputText value="#{data}" />
								</p:column>



							</p:dataTable>

						</h:panelGrid>
						<p:contextMenu for="tree">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addConflictRuleBean.moveToPanel('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addConflictRuleBean.moveToPanel('pan2')}" />
						</p:contextMenu>

						<p:contextMenu for="dataProperties">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addConflictRuleBean.moveToPanel2('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addConflictRuleBean.moveToPanel2('pan2')}" />
						</p:contextMenu>

						<p:contextMenu for="objectProperties">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addConflictRuleBean.moveToPanel2('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addConflictRuleBean.moveToPanel2('pan2')}" />
						</p:contextMenu>

						<p:contextMenu for="instances">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addConflictRuleBean.moveToPanel2('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addConflictRuleBean.moveToPanel2('pan2')}" />
						</p:contextMenu>

					</h:panelGrid>


					<h:panelGrid columns="2" id="panelsgrid">

						<p:panel header="conditions" id="pan1"
							style="height:800px;width:530px;">
							<f:facet name="header">
								<h:outputText value="Conditions" />
							</f:facet>
						<p:diagram value="#{addConflictRuleBean.conditionsModel}"
							id="conditionsDiagram" style="height:750px;width:500px;"
							styleClass="ui-widget-content" var="item">

							<f:facet name="element">
								<p:panel id="pnl1" header="#{item.elementName}">
									<h:panelGrid columns="3" id="elementGrid1">
										<h:outputText value="#{item.varName}"
											rendered="#{!item.renderEditText}" />
										<p:inputText label="value" rendered="#{item.renderEditText}"
											id="value" style="width: 80px;"
											value="#{item.valueOfProperty}">
										</p:inputText>
										<p:commandButton
											action="#{addConflictRuleBean.removeNode}"
											icon="ui-icon-close" title="Remove node"
											update=":#{p:component('pan1')}">
										<f:param name="id" value="#{item.varName}" />
										<f:param name="panel" value="conditions" />
										</p:commandButton>
									</h:panelGrid>
								</p:panel>
							</f:facet>

							<p:ajax event="connect"
								listener="#{addConflictRuleBean.onConnect}" />
							<p:ajax event="disconnect"
								listener="#{addConflictRuleBean.onDisconnect}" />
							<p:ajax event="connectionChange"
								listener="#{addConflictRuleBean.onConnectionChange}" />
						</p:diagram>
					</p:panel>

						<p:panel header="conclusions" id="pan2"
							style="height:800px;width:530px;">
							<p:diagram value="#{addConflictRuleBean.conclusionsModel}"
								style="height:750px;width:500px;" styleClass="ui-widget-content"
								var="item">
								<f:facet name="element">
									<p:panel id="pnl2" header="#{item.elementName}">
									<h:panelGrid columns="3" id="elementGrid2">
										<h:outputText value="#{item.varName}"
											rendered="#{!item.renderEditText}" />
										<p:inputText label="value" rendered="#{item.renderEditText}"
											id="value2" style="width: 80px;"
											value="#{item.valueOfProperty}">
										</p:inputText>
										<p:commandButton
											action="#{addConflictRuleBean.removeNode}"
											icon="ui-icon-close" title="Remove node"
											update=":#{p:component('pan2')}">
										<f:param name="id" value="#{item.varName}" />
										<f:param name="panel" value="conclusions" />
										</p:commandButton>
									</h:panelGrid>
								</p:panel>
								</f:facet>
								<p:ajax event="connect"
									listener="#{addConflictRuleBean.onConnect}" />
								<p:ajax event="disconnect"
									listener="#{addConflictRuleBean.onDisconnect}" />
								<p:ajax event="connectionChange"
									listener="#{addConflictRuleBean.onConnectionChange}" />
							</p:diagram>


						</p:panel>

					</h:panelGrid>


				<p:commandButton ajax="false"
				    actionListener="#{addConflictRuleBean.saveRule}"
					value="Save Rule" title="Save the rule">
				</p:commandButton>
				<p:commandButton id="clearConditions"
					update=":#{p:component('pan1')}"
					actionListener="#{addConflictRuleBean.clearPanel('pan1')}"
					ajax="false" value="Clear conditions"
					title="Clear conditions panel">
				</p:commandButton>
				<p:commandButton id="clearConclusions"
					update=":#{p:component('pan2')}"
					actionListener="#{addConflictRuleBean.clearPanel('pan2')}"
					ajax="false" value="Clear conclusions"
					title="Clear conclusions panel">
				</p:commandButton>

				
			</p:panel>
			
			

		</h:form>

		<p:dialog widgetVar="newRuleDialog" id="newRuleDialog" modal="true"
			header="Save rule" resizable="false" showEffect="clip" dynamic="true"
			hideEffect="fold" position="center,center" appendToBody="true">
			<h:form>
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<h:outputText value="Rule name: " id="ruleName" />
					<p:inputText label="Rule name" style="width: 300px;"
						id="newRuleName" autocomplete="off"
						value="#{addConflictRuleBean.ruleName}">
					</p:inputText>

					<h:outputText value="Insert a new file name: " id="FileName"
						required="false" />
					<p:inputText label="File Name" required="false"
						style="width: 300px;" id="newFileName" autocomplete="off"
						value="#{addConflictRuleBean.newFileName}">
					</p:inputText>

				</h:panelGrid>
			</h:form>
		</p:dialog>
	</h:body>
</f:view>