<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="form" enctype="multipart/form-data">
			<p:panel id="informationPanel">
				<f:facet name="header">
					<h:outputText value="Step2: Create a conflict/resolution Rule" />
				</f:facet>

				<h:panelGrid columns="2" id="grid1">
					<p:scrollPanel style="width:535px;height:800px;" mode="native">
						<p:tree id="tree" value="#{addNewRuleBean.root}" var="node"
							orientation="horizontal" selectionMode="single"
							selection="#{addNewRuleBean.selectedNode}"  >
							<p:ajax event="select" listener="#{addNewRuleBean.onNodeSelect}"
								update=":#{p:component('dataProperties')},
								:#{p:component('objectProperties')},:#{p:component('instances')}" />
							<p:treeNode>
								<h:outputText value="#{node}" />
							</p:treeNode>
						</p:tree>
					</p:scrollPanel>
					<h:panelGrid rows="4" id="grid2" style="width:535px;">

						<p:dataTable id="dataProperties" var="data"
							value="#{addNewRuleBean.datatypes}" rowKey="#{data.ontologyURI}"
							selectionMode="single"
							selection="#{addNewRuleBean.selectedDataProperty}"
							scrollable="true" scrollHeight="100">
							<f:facet name="header">
								<h:outputText value="Data Properties" />
							</f:facet>

							<p:column headerText="Name">
								<h:outputText value="#{data.propertyName}" />
							</p:column>
							<p:column headerText="Value Range">
								<h:outputText value="#{data.dataRange}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="objectProperties" var="data"
							value="#{addNewRuleBean.objects}" rowKey="#{data.ontologyURI}"
							selectionMode="single"
							selection="#{addNewRuleBean.selectedObjectProperty}"
							scrollable="true" scrollHeight="100">
							<f:facet name="header">
								<h:outputText value="Object Properties" />
							</f:facet>

							<p:column headerText="Name">
								<h:outputText value="#{data.propertyName}" />
							</p:column>
							<p:column headerText="Range">
								<h:outputText value="#{data.rangeOfClasses[0]}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="instances" var="data"
							value="#{addNewRuleBean.instances}" rowKey="#{data}"
							selectionMode="single"
							selection="#{addNewRuleBean.selectedInstance}"
							scrollable="true" scrollHeight="50">

							<p:column headerText="Instances">
								<h:outputText value="#{data.instanceName}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="methods" var="method" value="#{main.methods}"
							rowKey="#{method.originalName}" selectionMode="single"
							selection="#{addNewRuleBean.selectedMethod}" scrollable="true"
							scrollHeight="100">
							<p:column headerText="Primitive Methods">
								<h:outputText value="#{method.usingName}"
									id="method" />
								<p:tooltip id="toolTipGrow" for="method" value="#{method.description}"
                                showEffect="clip" hideEffect="explode" />
							</p:column>
						</p:dataTable>

					</h:panelGrid>
					<p:contextMenu for="tree">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')}"
							actionListener="#{addNewRuleBean.createClassElement('pan1')}" />
						<p:menuitem value="Move to conclusions"
							update=":#{p:component('pan2')}"
							actionListener="#{addNewRuleBean.createClassElement('pan2')}" />
					</p:contextMenu>

					<p:contextMenu for="methods">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')}"
							actionListener="#{addNewRuleBean.createMethodElement('pan1')}" />
						<p:menuitem value="Move to conclusions"
							update=":#{p:component('pan2')}"
							actionListener="#{addNewRuleBean.createMethodElement('pan2')}" />
					</p:contextMenu>

					<p:contextMenu for="dataProperties">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')},:#{p:component('dataProperties')}"
							actionListener="#{addNewRuleBean.createPropertyElement('pan1')}" />
						<p:menuitem value="Move to conclusions"
							update=":#{p:component('pan2')},:#{p:component('dataProperties')}"
							actionListener="#{addNewRuleBean.createPropertyElement('pan2')}" />
					</p:contextMenu>

					<p:contextMenu for="objectProperties">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')},:#{p:component('objectProperties')}"
							actionListener="#{addNewRuleBean.createPropertyElement('pan1')}" />
						<p:menuitem value="Move to conclusions"
							update=":#{p:component('pan2')},:#{p:component('objectProperties')}"
							actionListener="#{addNewRuleBean.createPropertyElement('pan2')}" />
					</p:contextMenu>

					<p:contextMenu for="instances">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')}"
							actionListener="#{addNewRuleBean.createInstanceElement('pan1')}" />
						<p:menuitem value="Move to conclusions"
							update=":#{p:component('pan2')}"
							actionListener="#{addNewRuleBean.createInstanceElement('pan2')}" />
					</p:contextMenu>

				</h:panelGrid>


				<h:panelGrid columns="2" id="panelsgrid">

					<p:panel header="conditions" id="pan1"
						style="height:800px;width:530px;">
						<f:facet name="header">
							<h:outputText value="Conditions" />
						</f:facet>
						<p:diagram value="#{addNewRuleBean.conditionsModel}"
							id="conditionsDiagram" style="height:750px;width:500px;"
							styleClass="ui-widget-content" var="item">

							<f:facet name="element">
								<p:panel id="pnl1" header="#{item.elementName}">
									<h:panelGrid columns="4" id="elementGrid1">
										<h:outputText value="Variable: #{item.varName}"
											rendered="#{item.editVar}" />
										<h:outputText label="value" rendered="#{item.editValue}"
											id="value" style="width: 80px;" autocomplete="off"
											value="Value: #{item.property.value}" />

										<p:commandButton oncomplete="PF('editDialog').show()"
											actionListener="#{addNewRuleBean.editNode}" title="View"
											icon="ui-icon-search" update=":#{p:component('editDialog')}">
											<f:param name="id" value="#{item.varName}" />
											<f:param name="panel" value="conditions" />
										</p:commandButton>
									</h:panelGrid>
								</p:panel>
							</f:facet>

							<p:ajax event="connect" listener="#{addNewRuleBean.onConnect}"
								update=":#{p:component('pan1')}" />
							<p:ajax event="disconnect"
								listener="#{addNewRuleBean.onDisconnect}" />
							<p:ajax event="connectionChange"
								listener="#{addNewRuleBean.onConnectionChange}"
								update=":#{p:component('pan1')}" />
						</p:diagram>
					</p:panel>

					<p:panel header="conclusions" id="pan2"
						style="height:800px;width:530px;">
						<p:diagram value="#{addNewRuleBean.conclusionsModel}"
							style="height:750px;width:500px;" styleClass="ui-widget-content"
							var="item">
							<f:facet name="element">
								<p:panel id="pnl2" header="#{item.elementName}">
									<h:panelGrid columns="3" id="elementGrid2">
										<h:outputText value="Variable: #{item.varName}"
											rendered="#{item.editVar}" />
										<h:outputText label="value" rendered="#{item.editValue}"
											id="value2" style="width: 80px;"
											value="Value: #{item.property.value}" />
										<p:commandButton oncomplete="PF('editDialog').show()"
											actionListener="#{addNewRuleBean.editNode}" title="View"
											icon="ui-icon-search" update=":#{p:component('editDialog')}">
											<f:param name="id" value="#{item.varName}" />
											<f:param name="panel" value="conclusions" />
										</p:commandButton>
									</h:panelGrid>
								</p:panel>
							</f:facet>
							<p:ajax event="connect" listener="#{addNewRuleBean.onConnect}"
								update=":#{p:component('pan2')}" />
							<p:ajax event="disconnect"
								listener="#{addNewRuleBean.onDisconnect}" />
							<p:ajax event="connectionChange"
								listener="#{addNewRuleBean.onConnectionChange}"
								update=":#{p:component('pan2')}" />
						</p:diagram>


					</p:panel>

				</h:panelGrid>


				<p:commandButton actionListener="#{addRuleStep1Bean.init}"
					action="/views/addRuleStep1Bean.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal"
					title="Go to initial menu" id="prevBut" ajax="false"
					value="Previous step">
				</p:commandButton>
				<p:commandButton id="clearConditions"
					update=":#{p:component('pan1')}"
					actionListener="#{addNewRuleBean.clearPanel('pan1')}" ajax="false"
					value="Clear conditions" title="Clear conditions panel">
				</p:commandButton>
				<p:commandButton id="clearConclusions"
					update=":#{p:component('pan2')}"
					actionListener="#{addNewRuleBean.clearPanel('pan2')}" ajax="false"
					value="Clear conclusions" title="Clear conclusions panel">
				</p:commandButton>
				<p:commandButton oncomplete="PF('addMessageDialog').show()"
					title="Go to next step of the creation of the rule" value="Next step">
				</p:commandButton>
			</p:panel>

			<p:dialog widgetVar="editDialog" id="editDialog" modal="true"
				header="Edit node" resizable="false" showEffect="clip"
				dynamic="true" hideEffect="fold" position="center,center">
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<h:outputText value="Variable name: " id="clonedVar"
						rendered="#{addNewRuleBean.cloneSelectedNode.editVar}" />
					<p:inputText label="Rule name" style="width: 300px;"
						id="clonedVar1" autocomplete="off"
						rendered="#{addNewRuleBean.cloneSelectedNode.editVar}"
						value="#{addNewRuleBean.cloneSelectedNode.varName}"
						required="true">
					</p:inputText>
					<p:watermark for="clonedVar1"
						value="Insert a variable name e.g ?Sol" id="watermarkVar" />
					<!--  	<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}" />-->

					<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}" />
					<p:inputText
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}"
						style="width: 300px;" id="clonedValue1" autocomplete="off"
						value="#{addNewRuleBean.cloneSelectedNode.property.value}">
					</p:inputText>
					<p:watermark for="clonedValue1"
						value="Insert a value e.g ?value or 
					'test'"
						id="watermarkValue" />
					<!--  	<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}" />-->
					<p:commandButton action="#{addNewRuleBean.saveEditOfNode}"
						icon="ui-icon-save" title="Save changes"
						rendered="#{addNewRuleBean.cloneSelectedNode.enableEdit}"
						update=":#{p:component('pan1')},:#{p:component('pan2')}"
						value="Save" oncomplete="PF('editDialog').hide()">
					</p:commandButton>
					<p:commandButton action="#{addNewRuleBean.removeNode}"
						icon="ui-icon-close" title="Remove node"
						update=":#{p:component('pan1')},:#{p:component('pan2')}"
						value="Delete" oncomplete="PF('editDialog').hide()">
					</p:commandButton>
				</h:panelGrid>
			</p:dialog>

			<p:dialog widgetVar="addMessageDialog" id="addMessageDialog"
				modal="true"
				header="Do you want this rule send a message to the user?"
				resizable="false" showEffect="clip" dynamic="true" hideEffect="fold"
				position="center,center">
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<p:commandButton actionListener="#{addMessageBean.init(false)}"
						icon="ui-icon-save" title="Move to next step to add a message" ajax="false"
						action="/views/addMessage.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal"
						value="Yes">
					</p:commandButton>
					<p:commandButton action="#{addNewRuleBean.removeNode}"
						icon="ui-icon-close" title="Save the rule withount adding a message"
						actionListener="#{addMessageBean.saveRule}"
						value="No" oncomplete="PF('addMessageDialog').hide()">
					</p:commandButton>
				</h:panelGrid>
			</p:dialog>

		</h:form>


	</h:body>
</f:view>