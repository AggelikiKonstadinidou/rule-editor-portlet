<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="form" enctype="multipart/form-data">
			<p:commandLink process="@this" immediate="true"
				action="/views/initialMenu.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal">
				<h:graphicImage url="/Home.png" styleClass="basicImageStyle"
					title="Go to initial menu" />
			</p:commandLink>
			<br />
			<br />
			<p:panel id="informationPanel">
				<f:facet name="header">
					<h:outputText value="New Feedback Rule" />
				</f:facet>

					<h:panelGrid columns="2" id="grid1">
						<p:tree id="tree" value="#{addNewRuleBean.root}" var="node"
							orientation="horizontal" selectionMode="single"
							selection="#{addNewRuleBean.selectedNode}"
							style="width:535px;">
							<p:ajax event="select"
								listener="#{addNewRuleBean.onNodeSelect}"
								update=":#{p:component('dataProperties')},
								:#{p:component('objectProperties')}" />
							<p:treeNode>
								<h:outputText value="#{node}" />
							</p:treeNode>


						</p:tree>
						<h:panelGrid rows="4" id="grid2" style="width:535px;">

						<p:dataTable id="dataProperties" var="data"
							value="#{addNewRuleBean.datatypes}"
							rowKey="#{data.ontologyURI}" selectionMode="single"
							selection="#{addNewRuleBean.selectedDataProperty}">
							<f:facet name="header">
								<h:outputText value="Data Properties" />
							</f:facet>

							<p:column headerText="Name">
								<h:outputText value="#{data.propertyName}" />
							</p:column>
							<p:column headerText="Value Range">
								<h:outputText value="#{data.dataRange}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="objectProperties" var="data"
							value="#{addNewRuleBean.objects}"
							rowKey="#{data.ontologyURI}" selectionMode="single"
							selection="#{addNewRuleBean.selectedObjectProperty}">
							<f:facet name="header">
								<h:outputText value="Object Properties" />
							</f:facet>

							<p:column headerText="Name">
								<h:outputText value="#{data.propertyName}" />
							</p:column>
							<p:column headerText="Range">
								<h:outputText value="#{data.propertyName}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="instances" var="data"
							value="#{addNewRuleBean.instances}" rowKey="#{data}"
							selectionMode="single">

							<p:column headerText="Instances">
								<h:outputText value="#{data}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="methods" var="method" value="#{main.methods}"
							rowKey="#{method.originalName}" selectionMode="single"
							selection="#{addNewRuleBean.selectedMethod}">
							<p:column headerText="Primitive Methods">
								<h:outputText value="#{method.usingName}" />
							</p:column>
						</p:dataTable>

					</h:panelGrid>
						<p:contextMenu for="tree">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addNewRuleBean.moveToPanel('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addNewRuleBean.moveToPanel('pan2')}" />
						</p:contextMenu>
						
						<p:contextMenu for="methods">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addNewRuleBean.moveMethodToPanel('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addNewRuleBean.moveMethodToPanel('pan2')}" />
						</p:contextMenu>

						<p:contextMenu for="dataProperties">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')},:#{p:component('dataProperties')}"
								actionListener="#{addNewRuleBean.moveToPanel2('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')},:#{p:component('dataProperties')}"
								actionListener="#{addNewRuleBean.moveToPanel2('pan2')}" />
						</p:contextMenu>

						<p:contextMenu for="objectProperties">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')},:#{p:component('objectProperties')}"
								actionListener="#{addNewRuleBean.moveToPanel2('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')},:#{p:component('objectProperties')}"
								actionListener="#{addNewRuleBean.moveToPanel2('pan2')}" />
						</p:contextMenu>

						<p:contextMenu for="instances">
							<p:menuitem value="Move to conditions"
								update=":#{p:component('pan1')}"
								actionListener="#{addNewRuleBean.moveToPanel2('pan1')}" />
							<p:menuitem value="Move to conclusions"
								update=":#{p:component('pan2')}"
								actionListener="#{addNewRuleBean.moveToPanel2('pan2')}" />
						</p:contextMenu>

					</h:panelGrid>


					<h:panelGrid columns="2" id="panelsgrid">

						<p:panel header="conditions" id="pan1"
							style="height:800px;width:530px;">
							<f:facet name="header">
								<h:outputText value="Conditions" />
							</f:facet>
						<p:diagram value="#{addNewRuleBean.conditionsModel}"
							id="conditionsDiagram" style="height:750px;width:500px;"
							styleClass="ui-widget-content" var="item">

							<f:facet name="element">
								<p:panel id="pnl1" header="#{item.type}: #{item.elementName}">
									<h:panelGrid columns="4" id="elementGrid1">
										<h:outputText value="Variable: #{item.varName}"
											rendered="#{!item.renderEditText}" />
										<h:outputText label="value" rendered="#{item.renderEditText}"
											id="value" style="width: 80px;" autocomplete="off"
											value="Value: #{item.property.value}"/>
										
										<p:commandButton oncomplete = "PF('editDialog').show()"
											actionListener="#{addNewRuleBean.editNode}" title="View"
											icon="ui-icon-search" update=":#{p:component('editDialog')}">
											<f:param name="id" value="#{item.varName}" />
											<f:param name="panel" value="conditions" />
										</p:commandButton>
									</h:panelGrid>
								</p:panel>
							</f:facet>

							<p:ajax event="connect"
								listener="#{addNewRuleBean.onConnect}" />
							<p:ajax event="disconnect"
								listener="#{addNewRuleBean.onDisconnect}" />
							<p:ajax event="connectionChange"
								listener="#{addNewRuleBean.onConnectionChange}" />
						</p:diagram>
					</p:panel>

						<p:panel header="conclusions" id="pan2"
							style="height:800px;width:530px;">
							<p:diagram value="#{addNewRuleBean.conclusionsModel}"
								style="height:750px;width:500px;" styleClass="ui-widget-content"
								var="item">
								<f:facet name="element">
									<p:panel id="pnl2" header="#{item.type}: #{item.elementName}">
									<h:panelGrid columns="3" id="elementGrid2">
										<h:outputText value="Variable: #{item.varName}"
											rendered="#{!item.renderEditText}" />
										<h:outputText label="value" rendered="#{item.renderEditText}"
											id="value2" style="width: 80px;"
											value="Value: #{item.property.value}"/>
										<p:commandButton oncomplete = "PF('editDialog').show()"
											actionListener="#{addNewRuleBean.editNode}" title="View"
											icon="ui-icon-search" update=":#{p:component('editDialog')}">
											<f:param name="id" value="#{item.varName}" />
											<f:param name="panel" value="conclusions" />
										</p:commandButton>
									</h:panelGrid>
								</p:panel>
								</f:facet>
								<p:ajax event="connect"
									listener="#{addNewRuleBean.onConnect}" />
								<p:ajax event="disconnect"
									listener="#{addNewRuleBean.onDisconnect}" />
								<p:ajax event="connectionChange"
									listener="#{addNewRuleBean.onConnectionChange}" />
							</p:diagram>


						</p:panel>

					</h:panelGrid>

				<p:panel id="feedbackMessages" style="margin-top:10px">

					<f:facet name="header">
						<h:outputText value="FeedBack Messages" id="feed"
							title="Add feedback messages in different languages to support the rule" />
					</f:facet>

					<c:forEach items="#{addNewRuleBean.messages}" var="item"
						varStatus="status">

						<p:panelGrid style="width:100%;margin-bottom:5px">
							<p:row>
								<p:column style="font-weight: bold;">Language
									<p:selectOneMenu value="#{item.language}"
										style="width:150px">
										<f:selectItems value="#{main.languages}" />
									</p:selectOneMenu>
								</p:column>
								<p:column style="font-weight: bold;">Message text
									<p:inputText value="#{item.text}" style="width: 300px;" />
								</p:column>
								<p:column style="font-weight: bold;">
									<p:commandButton value="Remove message"
										rendered="#{addNewRuleBean.messages.size() > 1}"
										action="#{addNewRuleBean.removeMessageFromList}"
										update="feedbackMessages" icon="ui-icon-close"
										title="Remove message">
										<f:setPropertyActionListener value="#{item}"
											target="#{addNewRuleBean.messageForRemove}" />
									</p:commandButton>
								</p:column>
							</p:row>
						</p:panelGrid>

					</c:forEach>
					
					<p:commandButton value="Add message"
						actionListener="#{addNewRuleBean.addMessageToList}"
						update="feedbackMessages" icon="ui-icon-plus"
						title="Add a message in a another language" />
						
					<br/>
					<h:outputText value="Select file" />
					<p:fileUpload auto="true" style="width: 600px;"
						value="#{addNewRuleBean.feedbackFile}"
						fileUploadListener="#{addNewRuleBean.onFileUpload}"
						allowTypes="/(\.|\/)(jsonld)$/">
					</p:fileUpload>
					
				</p:panel>


				<p:commandButton oncomplete="PF('newRuleDialog').show()"
					value="Save Rule" title="Save the rule">
				</p:commandButton>
				<p:commandButton id="clearConditions"
					update=":#{p:component('pan1')}"
					actionListener="#{addNewRuleBean.clearPanel('pan1')}"
					ajax="false" value="Clear conditions"
					title="Clear conditions panel">
				</p:commandButton>
				<p:commandButton id="clearConclusions"
					update=":#{p:component('pan2')}"
					actionListener="#{addNewRuleBean.clearPanel('pan2')}"
					ajax="false" value="Clear conclusions"
					title="Clear conclusions panel">
				</p:commandButton>

				
			</p:panel>
			

			<p:dialog widgetVar="newRuleDialog" id="newRuleDialog" modal="true"
				header="Save rule configuration" resizable="false" showEffect="clip"
				dynamic="true" hideEffect="fold" position="center,center">
				<p:messages for="msgs" showDetail="true" autoUpdate="true"
					closable="true" />
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<h:outputText value="Rule name: " id="ruleName" />
					<p:inputText label="Rule name" style="width: 300px;"
						id="newRuleName" autocomplete="off"
						value="#{addNewRuleBean.ruleName}"
						required="true">
					</p:inputText>

					<h:outputText value="File name: " id="FileName"
						required="false" />
					<p:inputText label="File Name" required="true"
						style="width: 300px;" id="newFileName" autocomplete="off"
						value="#{addNewRuleBean.newFileName}">
					</p:inputText>
					<p:commandButton value="OK" id="okBut" ajax="false"
						oncomplete="PF('newRuleDialog').hide()"
						actionListener="#{addNewRuleBean.saveRule}" />
					<p:commandButton value="Cancel" id="cancelBut"
						oncomplete="PF('newRuleDialog').hide()" />

				</h:panelGrid>
			</p:dialog>

			<p:dialog widgetVar="editDialog" id="editDialog" modal="true"
				header="Edit node" resizable="false" showEffect="clip"
				dynamic="true" hideEffect="fold" position="center,center">
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<h:outputText value="Variable name: " id="clonedVar"
						rendered="#{!addNewRuleBean.cloneSelectedNode.renderEditText}" />
					<p:inputText label="Rule name" style="width: 300px;"
						id="clonedVar1" autocomplete="off"
						rendered="#{!addNewRuleBean.cloneSelectedNode.renderEditText}"
						value="#{addNewRuleBean.cloneSelectedNode.varName}"
						required="true">
					</p:inputText>

					<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.renderEditText}" />
					<p:inputText
						rendered="#{addNewRuleBean.cloneSelectedNode.renderEditText}"
						style="width: 300px;" id="clonedValue1" autocomplete="off"
						value="#{addNewRuleBean.cloneSelectedNode.property.value}">
					</p:inputText>
					<p:commandButton
						action="#{addNewRuleBean.saveEditOfNode}"
						icon="ui-icon-save" title="Save changes"
						update=":#{p:component('pan1')},:#{p:component('pan2')}"
						value="Save" oncomplete="PF('editDialog').hide()">
					</p:commandButton>
					<p:commandButton
						action="#{addNewRuleBean.removeNode}"
						icon="ui-icon-close" title="Remove node"
						update=":#{p:component('pan1')},:#{p:component('pan2')}"
						value="Delete" oncomplete="PF('editDialog').hide()">
					</p:commandButton>
				</h:panelGrid>
			</p:dialog>

		</h:form>

		
	</h:body>
</f:view>