<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="form" enctype="multipart/form-data">
			<p:panel id="informationPanel">
				<f:facet name="header">
					<h:outputText value="Step2: Create a Feedback Rule" />
				</f:facet>

				<h:panelGrid columns="2" id="grid1">
					<p:scrollPanel style="width:535px;height:800px;" mode="native">
						<p:tree id="tree" value="#{addNewRuleBean.root}" var="node"
							orientation="horizontal" selectionMode="single"
							selection="#{addNewRuleBean.selectedNode}">
							<p:ajax event="select" listener="#{addNewRuleBean.onNodeSelect}"
								update=":#{p:component('dataProperties')},
								:#{p:component('objectProperties')},:#{p:component('instances')}" />
							<p:treeNode>
								<h:outputText value="#{node}" />
							</p:treeNode>
						</p:tree>
					</p:scrollPanel>

					<h:panelGrid rows="4" id="grid2" style="width:535px;">

						<p:dataTable id="dataProperties" var="data"
							value="#{addNewRuleBean.datatypes}" rowKey="#{data.ontologyURI}"
							selectionMode="single"
							selection="#{addNewRuleBean.selectedDataProperty}"
							scrollable="true" scrollHeight="100">
							<f:facet name="header">
								<h:outputText value="Data Properties" />
							</f:facet>

							<p:column headerText="Name">
								<h:outputText value="#{data.propertyName}" />
							</p:column>
							<p:column headerText="Value Range">
								<h:outputText value="#{data.dataRange}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="objectProperties" var="data"
							value="#{addNewRuleBean.objects}" rowKey="#{data.ontologyURI}"
							selectionMode="single"
							selection="#{addNewRuleBean.selectedObjectProperty}"
							scrollable="true" scrollHeight="100">
							<f:facet name="header">
								<h:outputText value="Object Properties" />
							</f:facet>

							<p:column headerText="Name">
								<h:outputText value="#{data.propertyName}" />
							</p:column>
							<p:column headerText="Range">
								<h:outputText value="#{data.rangeOfClasses[0]}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="instances" var="data"
							value="#{addNewRuleBean.instances}" rowKey="#{data}"
							selectionMode="single"
							selection="#{addNewRuleBean.selectedInstance}"
							scrollable="true" scrollHeight="50">

							<p:column headerText="Instances">
								<h:outputText value="#{data.instanceName}" />
							</p:column>

						</p:dataTable>

						<p:dataTable id="methods" var="method" value="#{main.methods}"
							rowKey="#{method.originalName}" selectionMode="single"
							selection="#{addNewRuleBean.selectedMethod}"
							scrollable="true" scrollHeight="100">
							<p:column headerText="Primitive Methods">
								<h:outputText value="#{method.usingName}"
									id="method" />
								<p:tooltip id="toolTipGrow" for="method" value="#{method.description}"
                                showEffect="clip" hideEffect="explode" />
							</p:column>
						</p:dataTable>

					</h:panelGrid>

					<p:contextMenu for="methods">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')}"
							actionListener="#{addNewRuleBean.createMethodElement('pan1')}" />
					</p:contextMenu>

					<p:contextMenu for="dataProperties">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')},:#{p:component('dataProperties')}"
							actionListener="#{addNewRuleBean.createPropertyElement('pan1')}" />
					</p:contextMenu>

					<p:contextMenu for="objectProperties">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')},:#{p:component('objectProperties')}"
							actionListener="#{addNewRuleBean.createPropertyElement('pan1')}" />
					</p:contextMenu>

					<p:contextMenu for="instances">
						<p:menuitem value="Move to conditions"
							update=":#{p:component('pan1')}"
							actionListener="#{addNewRuleBean.createInstanceElement('pan1')}" />
					</p:contextMenu>

				</h:panelGrid>

				<p:panel header="Conditions" id="pan1" style="height:700px;">
					<p:diagram value="#{addNewRuleBean.conditionsModel}"
						id="conditionsDiagram" style="height:650px;"
						styleClass="ui-widget-content" var="item">

						<f:facet name="element">
							<p:panel id="pnl1" header="#{item.elementName}">
								<h:panelGrid columns="1" columnClasses="label"
										id="elementGrid1">

										<h:outputText value="Order: #{item.order}"
											rendered="#{item.order!=0}" />

										<h:outputText label="varName"
											rendered="#{item.property.ontologyURI!=''}" id="classVar"
											style="width: 80px;" autocomplete="off"
											value="Var: #{item.property.classVar}" />

										<h:outputText label="value" rendered="#{item.editValue}"
											id="value" style="width: 80px;" autocomplete="off"
											value="Value: #{item.property.value}" />


									</h:panelGrid>
									<p:commandButton oncomplete="PF('editDialog').show()"
										actionListener="#{addNewRuleBean.editNode}" title="View"
										icon="ui-icon-search" update=":#{p:component('editDialog')}">
										<f:param name="id" value="#{item.id}" />
										<f:param name="panel" value="conditions" />
									</p:commandButton>
							</p:panel>
						</f:facet>

						<p:ajax event="connect" listener="#{addNewRuleBean.onConnect}" />
						<p:ajax event="disconnect"
							listener="#{addNewRuleBean.onDisconnect}" />
						<p:ajax event="connectionChange"
							listener="#{addNewRuleBean.onConnectionChange}" />
					</p:diagram>
				</p:panel>

				<p:commandButton actionListener="#{addRuleStep1Bean.init}"
					action="/views/addRuleStep1Bean.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal"
					title="Go to initial menu" id="prevBut" ajax="false"
					value="Previous step">
				</p:commandButton>
				<p:commandButton actionListener="#{addMessageBean.init(true)}"
					action="/views/addMessage.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal"
					title="Move to the next step of the creation of the rule" id="nextBut" ajax="false"
					value="Next step">
				</p:commandButton>
				<p:commandButton id="clearConditions"
					update=":#{p:component('pan1')}"
					actionListener="#{addNewRuleBean.clearPanel('pan1')}" ajax="false"
					value="Clear conditions" title="Clear conditions panel">
				</p:commandButton>

			</p:panel>

			<p:dialog widgetVar="editDialog" id="editDialog" modal="true"
				header="Edit node" resizable="false" showEffect="clip"
				dynamic="true" hideEffect="fold" position="center,center">
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid4">
					<h:outputText value="Variable name: " id="clonedVar"
						rendered="#{addNewRuleBean.cloneSelectedNode.editVar}" />
					<p:inputText label="Rule name" style="width: 300px;"
						id="clonedVar1" autocomplete="off"
						rendered="#{addNewRuleBean.cloneSelectedNode.editVar}"
						value="#{addNewRuleBean.cloneSelectedNode.property.classVar}"
						required="true">
					</p:inputText>
					<p:watermark for="clonedVar1"
						value="Insert a variable name e.g ?Sol" id="watermarkVar" />
					<!--  	<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}" />-->

					<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}" />
					<p:inputText
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}"
						style="width: 300px;" id="clonedValue1" autocomplete="off"
						value="#{addNewRuleBean.cloneSelectedNode.property.value}">
					</p:inputText>
					<p:watermark for="clonedValue1"
						value="Insert a value e.g ?value or 
					'test'"
						id="watermarkValue" />
					<!--  	<h:outputText value="Value: " id="clonedValue" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.editValue}" />-->
					<h:outputText value="Value: " id="helpStr" required="false"
						rendered="#{addNewRuleBean.cloneSelectedNode.method.flag}" />
					<p:inputText
						rendered="#{addNewRuleBean.cloneSelectedNode.method.flag}"
						style="width: 300px;" id="helpStr1" autocomplete="off"
						value="#{addNewRuleBean.cloneSelectedNode.method.helpString}">
					</p:inputText>
					<p:commandButton action="#{addNewRuleBean.saveEditOfNode}"
						icon="ui-icon-save" title="Save changes"
						rendered="#{addNewRuleBean.cloneSelectedNode.enableEdit or addNewRuleBean.cloneSelectedNode.method.flag}"
						update=":#{p:component('pan1')}" value="Save"
						oncomplete="PF('editDialog').hide()">
					</p:commandButton>
					<p:commandButton action="#{addNewRuleBean.removeNode}"
						icon="ui-icon-close" title="Remove node"
						update=":#{p:component('pan1')}"
						value="Delete" oncomplete="PF('editDialog').hide()">
					</p:commandButton>
				</h:panelGrid>
			</p:dialog>

		</h:form>


	</h:body>
</f:view>