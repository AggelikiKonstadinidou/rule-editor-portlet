<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="form" enctype="multipart/form-data">
			<p:panel id="informationPanel">
				<f:facet name="header">
					<h:outputText value="Step3: Add Message to Rule" />
				</f:facet>

				<p:panel id="feedbackMessages" style="margin-top:10px">

					<f:facet name="header">
						<h:outputText value="FeedBack Rule Configuration" id="feed"
							title="Add feedback messages in different languages to support the rule" />
					</f:facet>
					<h:panelGrid columns="2" columnClasses="label,value"
						styleClass="grid3">
						<h:outputText
							value="The feedback rule will create message for class "
							id="className" />
						<p:inputText label="class name" style="width: 300px;"
							id="classNameValue" autocomplete="off"
							value="#{addMessageBean.feedbackClass}">
						</p:inputText>

						<h:outputText value="The feedback rule will have as scope "
							id="scope" />
						<p:inputText style="width: 300px;" id="scopeValue"
							autocomplete="off" value="#{addMessageBean.feedbackScope}">
						</p:inputText>

						<h:outputText value="The feedback rule will have as unique id "
							id="uniqueId" />
						<p:inputText style="width: 300px;" id="uniqueIdValue"
							autocomplete="off" value="#{addMessageBean.feedbackId}">
						</p:inputText>

					</h:panelGrid>

					<c:forEach items="#{addMessageBean.messages}" var="item"
						varStatus="status">

						<p:panelGrid style="width:100%;margin-bottom:5px">
							<p:row>
								<p:column style="font-weight: bold;">Language
									<p:selectOneMenu value="#{item.language}" style="width:150px">
										<f:selectItems value="#{main.languages}" />
									</p:selectOneMenu>
								</p:column>
								<p:column style="font-weight: bold;">Message text
									<p:inputText value="#{item.text}" style="width: 300px;" />
								</p:column>
								<p:column style="font-weight: bold;">
									<p:commandButton value="Remove message"
										rendered="#{addMessageBean.messages.size() > 1}"
										action="#{addMessageBean.removeMessageFromList}"
										update="feedbackMessages" icon="ui-icon-close"
										title="Remove message">
										<f:setPropertyActionListener value="#{item}"
											target="#{addMessageBean.messageForRemove}" />
									</p:commandButton>
								</p:column>
							</p:row>
						</p:panelGrid>

					</c:forEach>

					<p:commandButton value="Add message"
						actionListener="#{addMessageBean.addMessageToList}"
						update="feedbackMessages" icon="ui-icon-plus"
						title="Add a message in a another language" />

					<br />
					<h:panelGrid columns="2" columnClasses="label,value"
						styleClass="grid">
						<p:fileUpload style="width: 500px;" mode="advanced" auto="true"
							value="#{addMessageBean.feedbackFile}"
							label="Select feedbackMessages file"
							fileUploadListener="#{addMessageBean.onFileUpload}"
							allowTypes="/(\.|\/)(jsonld)$/">
						</p:fileUpload>
						<p:commandButton value="Export Messages" id="export" ajax="false"
							actionListener="#{addMessageBean.exportJsonLdFile}" />
					</h:panelGrid>
				</p:panel>


				<p:commandButton actionListener="#{addRuleStep1Bean.init}"
					action="/views/addRuleStep1Bean.xhtml?javax.portlet.faces.PortletMode=view&amp;javax.portlet.faces.WindowState=normal"
					title="Go to previous step of the creation of the rule" id="prevBut" ajax="false"
					value="Previous step">
				</p:commandButton>
				<p:commandButton oncomplete="PF('newRuleDialog').show()"
					value="Save Rule" title="Save the rule">
				</p:commandButton>

			</p:panel>


			<p:dialog widgetVar="newRuleDialog" id="newRuleDialog" modal="true"
				header="Save rule configuration" resizable="false" showEffect="clip"
				dynamic="true" hideEffect="fold" position="center,center">
				<p:messages for="msgs" showDetail="true" autoUpdate="true"
					closable="true" />
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<h:outputText value="Rule name: " id="ruleName" />
					<p:inputText label="Rule name" style="width: 300px;"
						id="newRuleName" autocomplete="off"
						value="#{addMessageBean.ruleName}" required="true">
					</p:inputText>
				</h:panelGrid>
				<p:fileUpload style="width: 600px;" mode="advanced"
					label="Select an existing rule file"
					value="#{addMessageBean.oldFileName}" auto="true"
					fileUploadListener="#{addMessageBean.uploadFileForSaveAs}"
					allowTypes="/(\.|\/)(rules)$/">
				</p:fileUpload>
				<h:panelGrid columns="2" columnClasses="label,value"
					styleClass="grid">
					<h:outputText value="Or create a new file " id="FileName"
						required="false" />
					<p:inputText label="File Name" style="width: 300px;"
						id="newFileName" autocomplete="off"
						value="#{addMessageBean.newFileName}">
					</p:inputText>
					<p:commandButton value="OK" id="okBut" ajax="false"
						oncomplete="PF('newRuleDialog').hide()"
						actionListener="#{addMessageBean.saveRule}" />
					<p:commandButton value="Cancel" id="cancelBut"
						oncomplete="PF('newRuleDialog').hide()" />
				</h:panelGrid>
			</p:dialog>

		</h:form>


	</h:body>
</f:view>