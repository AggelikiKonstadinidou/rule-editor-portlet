<?xml version="1.0"?>

<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>
		<h:form id="form">
			<p:panel id="informationPanel">
				<f:facet name="header">
					<h:outputText value="Configurate order of rules" />
				</f:facet>

				<br />
 
				<p:fileUpload style="width: 600px;" mode="advanced" label="Select configuration file of RBMM"
					value="#{configurateOrderBean.propertiesFileName}" auto="true" multiple ="true"
					fileUploadListener="#{configurateOrderBean.onFileUpload}"
					allowTypes="/(\.|\/)(properties)$/" update=":#{p:component('rules')}" >
				</p:fileUpload>

				<p:dataTable var="file" value="#{configurateOrderBean.listOfFileRules}"
					draggableRows="true" id="rules">
					<p:ajax event="rowReorder" listener="#{configurateOrderBean.onRowReorder}" />
					<f:facet name="header">
            Rule Files
        </f:facet>
					<p:column headerText="Name">
						<h:outputText value="#{file.fileName}" />
					</p:column>
					<p:column headerText="Upload File">
						<p:fileUpload style="width: 500px;" mode="advanced"
							label="Select #{rule} file"
							value="#{configurateOrderBean.ruleFileName}" auto="true"
							multiple="true" update=":#{p:component('objectRules')}"
							fileUploadListener="#{configurateOrderBean.onRuleFileUpload}"
							allowTypes="/(\.|\/)(rules)$/">
						</p:fileUpload>
					</p:column>
					<p:column style="width:32px;text-align: center">
						<p:commandButton
							oncomplete="PF('rulesDialog').show()" icon="ui-icon-search"
							title="View/Order Rules">
							<f:setPropertyActionListener value="#{file.fileName}"
								target="#{configurateOrderBean.selectedFile}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
				<p:commandButton value="Save changes" ajax="false"
					actionListener="#{configurateOrderBean.saveChanges}"
					title="Save and export the changes that were made in the configuation file" />

			</p:panel>

			<p:dialog header="Rules of #{configurateOrderBean.selectedFile.fileName}"
				widgetVar="rulesDialog" modal="true" showEffect="clip"
				dynamic="true" hideEffect="fold" position="center,center">
				<p:panelGrid columns="1" columnClasses="label" styleClass="grid">
					<p:dataTable var="rule" value="#{configurateOrderBean.selectedFile.rules}"
						draggableRows="true" id="objectRules" style="height:400px;width:400px;">
						<p:ajax event="rowReorder"
							listener="#{configurateOrderBean.onRowReorder}" />

						<p:column headerText="Name">
							<h:outputText value="#{rule.name}" />
						</p:column>

					</p:dataTable>
				</p:panelGrid>
			</p:dialog>

		</h:form>

	</h:body>
</f:view>